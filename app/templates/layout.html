{#
  layout.html override shim adding ebooks.lv nav link after Admin.
  This file shadows upstream template via updated template search path (ensure
  app/templates precedes calibre-web templates). It copies only the nav bar
  fragment by extending upstream and injecting a block after admin link.
  If upstream layout defines blocks differently, fallback to after_request injection.
#}
{% extends "../calibre-web/cps/templates/layout.html" %}
{% block navigation %}
  {{ super() }}
  {# Fallback: if our element not already present and user is admin, inject via script #}
  {% if current_user and current_user.role_admin() %}
  {% set nav_labels = {
    'ebooks': _('ebooks.lv'),
    'orders': _('Orders'),
    'mozello': _('Mozello')
  } %}
  <script>
  (function(){
    var labels = {{ nav_labels | tojson }};
    function createLinkHtml(id, href, icon, text){
      return '<a id="'+id+'" data-text="'+text+'" href="'+href+'">' +
        '<span class="glyphicon '+icon+'"></span> <span class="hidden-sm">'+text+'</span></a>';
    }
    try {
      if(!document.getElementById('top_users_books')){
        var admin=document.getElementById('top_admin');
        if(admin){
          var li=document.createElement('li');
          li.innerHTML=createLinkHtml('top_users_books', '/admin/ebookslv/', 'glyphicon-book', labels.ebooks);
          admin.parentNode.insertAdjacentElement('afterend', li);
        }
      }
    } catch(e) { if(window.console && console.debug){ console.debug('users_books nav js inject fail', e); } }
  })();
  </script>
  {% endif %}
{% endblock %}
